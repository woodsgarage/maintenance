<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Maintenance</title>
  <link rel="stylesheet" href="style.css">
  <script src="app.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const vin = getQueryParam("vin");
      document.getElementById("vehicleVIN").textContent = vin || "N/A";

      document.getElementById("maintenanceForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const odometer = document.getElementById("odometer").value;
        const service = document.getElementById("service").value;
        const parts = document.getElementById("parts").value;
        const notes = document.getElementById("notes").value;

        if (!odometer || !service) {
          alert("Please fill in all required fields.");
          return;
        }

        try {
          const data = {
            type: "maintenance",
            vin,
            odometer,
            service,
            parts,
            notes
          };
          const res = await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify(data)
          });
          const result = await res.json();
          if (result.status === "success") {
            alert("Maintenance added!");
            document.getElementById("maintenanceForm").reset();
          }
        } catch (err) {
          console.error(err);
          alert("Failed to add maintenance.");
        }
      });
    });
  </script>
</head>
<body>
  <header>Add Maintenance</header>
  <main>
    <h2>Vehicle VIN: <span id="vehicleVIN">Loading...</span></h2>
    <form id="maintenanceForm">
      <label for="odometer">Odometer:</label>
      <input type="number" id="odometer" required>

      <label for="service">Service:</label>
      <input type="text" id="service" required>

      <label for="parts">Parts:</label>
      <input type="text" id="parts">

      <label for="notes">Notes:</label>
      <textarea id="notes"></textarea>

      <button type="submit">Add Maintenance</button>
    </form>
  </main>
  <footer>&copy; 2026 Woods Garage</footer>
</body>
</html>
